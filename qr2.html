<!DOCTYPE html>
<html lang="ko">

  <head> 


   
      <script src="jquery-3.6.0.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>
      <link rel="stylesheet" href="main.css"/>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q4SGH4T63Z"></script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158111568-5"></script>
      <script>
      //사이트 데이터 측정및 분석코드: 구글애널리틱스
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-Q4SGH4T63Z');
      gtag('config', 'UA-158111568-5');
      </script>
      <script>
        //프론트앤드 서비스 오류 추적 및 분석코드 : JENNIFER Front
        (function(j,en,ni,fer) {
                j['dmndata']=[];j['jenniferFront']=function(args){window.dmndata.push(args)};
                j['dmnaid']=fer;j['dmnatime']=new Date();j['dmnanocookie']=false;j['dmnajennifer']='JENNIFER_FRONT@INTG';
                var b=Math.floor(new Date().getTime() / 60000) * 60000;var a=en.createElement(ni);
                a.src='https://d-collect.jennifersoft.com/'+fer+'/demian.js?'+b;a.async=true;
                en.getElementsByTagName(ni)[0].parentNode.appendChild(a);
            }(window,document,'script','d938cf8a'));
        </script>

  <link rel="shortcut icon" href="favicon.png" />
     <meta http-equiv="Cache-Control" content="no-chache"/>
    <meta http-equiv="Expires" content="0"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta property="og:url" content="https://ticket.ivyforest.kr">
    <meta property="og:title" content="2021 군성제 X 담쟁이숲"> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="icon" href="favicon.ico" />
    <meta name="viewport" content="width=device-width,  initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#26AF7A"/>
    <link rel="apple-touch-icon" href="logo192.png" />
    <meta name="title" content="2021 군성제 X 담쟁이숲"/>
    <meta name="Publisher" content="TEAM IVYFOREST [ 팀 담쟁이숲 ]">
    <meta name="robots" content="all">
 

   

    <title>2021 군성제 X 담쟁이숲 </title>

   

   



  <!-- 익스플로러 사용자경고문 -->
<script type="text/javascript" charset=utf-8>
          var agent = navigator.userAgent.toLowerCase();
if ( (navigator.appName == 'Netscape' && navigator.userAgent.search('Trident') != -1) || (agent.indexOf("msie") != -1) ) {

alert("[ 안내 ] 인터넷 익스플로러는 담쟁이숲에서 지원하지 않습니다. 기타 오류가 발생할 수 있으니, Chrome을 이용해 담쟁이숲에 접속해주세요!");

}
</script>


<!-- 익스플로러 사용자경고문 -->
  
</head>
  <body  overflow:hidden;  oncontextmenu='return false'  onselectstart='return false' ondragstart='return false'
 >









<noscript>자바스크립트를 활성해주셔야, 정상적으로 담쟁이숲을 이용하실 수 있습니다.</noscript>


<script type="text/javascript" src="./jsQR.js"></script>

<style type="text/css">

  main {

    width:100%;

    height:100%;

    text-align:center;

  }

  

  main > div {

    float:left;

    width:1%;

    height:98%;

  }

  main > div:first-child {

    width:49%;

  }

  

  main > div:last-child {

    background-color:#D3D3D3;

    width:49%;

  }



  div#output {

    background-color:#BDBEBD;

    padding-left:10px;

    padding-right:10px;

    padding-top:10px;

    padding-bottom:10px;

  }

  

  div#frame {

    

    
    margin-left:10px;

    margin-right:10px;

    padding-left:8px;

    padding-right:8px;

    padding-top:8px;

    padding-bottom:8px;

  }

  

  div#outputLayer {

    text-align:left;

  }

  

  canvas {
    margin-top: 30px;
    border-radius: 15px;
    width:80%;
    background-color:transparent;

  }




</style>

</head>

<body>

<main>

  <div id="main">

    <h1 style="color: white; margin-top: 30px; letter-spacing:-0.08rem;" >2021 군성제 QR 체크인</h1>

    <div  style="border-radius: 15px; width: 700px; text-align: center; margin-top: 65px; margin-left: 75px; height: 60px; background-color: white;" id="output" >

      <div id="outputMessage" style="font-size: 20px; margin-top:5px; text-align: center; letter-spacing:-0.08rem;">
        QR티켓을 카메라에 인식시켜주세요!
      </div>

        <div id="outputLayer"  style="font-size: 26px; margin-top:5px; text-align: center;" hidden>

          예약코드 : <span id="outputData"></span>

        </div>


    </div>

    
<div id="ticket_info" style="border-radius: 15px; width: 645px; text-align: center; margin-top: 45px; margin-left: 75px; height: 370px; background-color: white; " >

     

<p style="color: black; text-align: left; margin-top: 15px; margin-left: 25px; font-size: 18px; flex: 0.2; letter-spacing:-0.08rem;"><b><?php

$booker_key=  $_COOKIE['key'];

require("dbset.php");
$connect = mysqli_connect($address,$conId,$password,$dbName); 
mysqli_set_charset($connect,"utf8");

$sql = "SELECT festival_name from booker_table  WHERE booker_code1='$booker_key' OR booker_code2='$booker_key' order by booker_time desc limit 1";


$result = mysqli_query($connect, $sql) or die(mysqli_error($connect)); ;  



if (mysqli_num_rows($result) > 0) {
   while($row = mysqli_fetch_assoc($result)) {
   echo $row["festival_name"];


   }


   }else{
   echo "오류발생!";
   }



mysqli_close($connect);



?></b></p>
<p style="color: black; text-align: left; margin-top: -20px; margin-left: 25px; font-size: 65px; letter-spacing:-0.08rem;"><b><?php

  $booker_key=  $_COOKIE['key'];




require("dbset.php");
$connect = mysqli_connect($address,$conId,$password,$dbName); 
mysqli_set_charset($connect,"utf8");

$sql = "SELECT booker_seat from booker_table  WHERE booker_code1='$booker_key' OR booker_code2='$booker_key' order by booker_time desc limit 1";


$result = mysqli_query($connect, $sql) or die(mysqli_error($connect)); ;  



if (mysqli_num_rows($result) > 0) {
   while($row = mysqli_fetch_assoc($result)) {
   echo $row["booker_seat"];


   }


   }else{
   echo "오류발생!";
   }



mysqli_close($connect);



?></b></p>
<p style="color: black; text-align: left; margin-top: -60px; margin-left: 25px; font-size: 14px; letter-spacing:-0.08rem;"><b>공연회차</b></p>
<p style="color: black; text-align: left; margin-top: -15px; margin-left: 25px; font-size: 30px; letter-spacing:-0.08rem;"><b><?php

  $booker_key=  $_COOKIE['key'];


require("dbset.php");
$connect = mysqli_connect($address,$conId,$password,$dbName); 
mysqli_set_charset($connect,"utf8");

$sql = "SELECT booker_festivaltype from booker_table  WHERE booker_code1='$booker_key' OR booker_code2='$booker_key' order by booker_time desc limit 1";


$result = mysqli_query($connect, $sql) or die(mysqli_error($connect)); ;  



if (mysqli_num_rows($result) > 0) {
   while($row = mysqli_fetch_assoc($result)) {
   echo $row["booker_festivaltype"]."부";


   }


   }else{
   echo "오류발생!";
   }



mysqli_close($connect);



?></b></p>
<p style="color: black; text-align: left; margin-top: -25px; margin-left: 25px; font-size: 14px; letter-spacing:-0.08rem;"><b>시작시간</b></p>
<p style="color: black; text-align: left; margin-top: -15px; margin-left: 25px; font-size: 30px; letter-spacing:-0.08rem;"><b><?php

  $booker_key=  $_COOKIE['key'];


require("dbset.php");
$connect = mysqli_connect($address,$conId,$password,$dbName); 
mysqli_set_charset($connect,"utf8");

$sql = "SELECT festival_sttime from booker_table WHERE booker_code1='$booker_key' OR booker_code2='$booker_key' order by booker_time desc limit 1";


$result = mysqli_query($connect, $sql) or die(mysqli_error($connect)); ;  



if (mysqli_num_rows($result) > 0) {
   while($row = mysqli_fetch_assoc($result)) {
   echo $row["festival_sttime"];


   }


   }else{
   echo "오류발생!";
   }



mysqli_close($connect);



?></b></p>
       
    </div>
 

  </div>

  <div>&nbsp;</div>

  <div style="background-color:transparent; margin-top: 15px;">

    <h1 style="color: white; letter-spacing:-0.08rem;">아래에 QR티켓을 인식시켜주세요</h1>




      <canvas id="canvas"></canvas>

   

  </div>

</main>



</body>

</html>



<script type="text/javascript"> 

var qrcodedata = "aaaaaaa";


function divrefresh(){  
      $("#ticket_info").load(location.href + " #ticket_info");
}


function cookieset() {
  var selected5 = localStorage.getItem('key');


  var setCookie = function(name, value, exp) {
        var date = new Date();
        date.setTime(date.getTime() + exp*24*60*60*1000);
        document.cookie = name + '=' + value + ';expires=' + date.toUTCString() + ';path=/';
    };
  
  
    setCookie("key", (selected5), 14);
    


  

  }






  document.addEventListener("DOMContentLoaded", function() {

    
    

    var video = document.createElement("video");    

    var canvasElement = document.getElementById("canvas");

    var canvas = canvasElement.getContext("2d");


    var outputContainer = document.getElementById("output");
 
    var outputMessage = document.getElementById("outputMessage");

    var outputData = document.getElementById("outputData");

    

    

    function drawLine(begin, end, color) {

      

      canvas.beginPath();

      canvas.moveTo(begin.x, begin.y);

      canvas.lineTo(end.x, end.y);

      canvas.lineWidth = 6;

      canvas.strokeStyle = color;

      canvas.stroke();

                }

      

          // 카메라 사용시

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {

      

                  video.srcObject = stream;

                  video.setAttribute("playsinline", true);      // iOS 사용시 전체 화면을 사용하지 않음을 전달

            video.play();

                  requestAnimationFrame(tick);

    });



    function tick() {

      


      

      if(video.readyState === video.HAVE_ENOUGH_DATA) {

        


                  canvasElement.hidden = false;

                  outputContainer.hidden = false;

            

                  // 읽어들이는 비디오 화면의 크기

                  canvasElement.height = video.videoHeight;

                  canvasElement.width = video.videoWidth;

                  

            

                  canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);

                  var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);


 


                  var code = jsQR(imageData.data, imageData.width, imageData.height, {
                  
                  


                                    inversionAttempts : "dontInvert",

                  });
                  
                


                              // QR코드 인식에 성공한 경우

                              if(code) {

                              


                                    // 인식한 QR코드의 영역을 감싸는 사용자에게 보여지는 테두리 생성

                                    drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF0000");

                                    drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF0000");

                                    drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF0000");

                                    drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF0000");


                                    outputMessage.hidden = true;

                                    outputData.parentElement.hidden = false;

                                    
                                 
                                    localStorage.setItem("key", code.data);
                                    cookieset();

                                    var userkey =  localStorage.getItem("key");


                                    // QR코드 메시지 출력

                                    outputData.innerHTML = userkey;
                                    
                                    divrefresh();
                                    
                                    //if (localStorage.key !== code.data  ) {

                                    //var audio = new Audio('MP_Pling.mp3');
                                    //audio.play();

                                   // }
                                  
                                 

                                    // return을 써서 함수를 빠져나가면 QR코드 프로그램이 종료된다.

                                  
                                   
                              }

            

                              // QR코드 인식에 실패한 경우 

                              else {

                                  

                                    outputMessage.hidden = false;

                                 


                              }

                              
                             
                       
                      }

          
                requestAnimationFrame(tick);
               
              

    }

  });






</script>